<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>hello</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
		<script type="text/javascript" src="/socket.io/socket.io.js"></script>
  </head>
  <body>
    <h5>hello world</h5>
		<video src="" id="video" style="width:680px;height:320px;" autoplay="true"></video>
	<canvas style="display:none;"id="preview"></canvas>
	<div id="logger"></div>
	<script>
	 var canvas = document.getElementById("preview");
	 var context = canvas.getContext("2d");
	 
	 canvas.width = 800;
	 canvas.height = 600;
	 context.width = canvas.width;
	 context.height = canvas.height;
	 var video = document.getElementById("video");
	 var socket = io();
	 
	 function logger(msg){
		$("#logger").text(msg);		
	 }
	 function loadCam(stream){
		video.src = window.URL.createObjectURL(stream);
		logger("camera has been connected");
	 }
	 function loadFail(){
		logger("camera no connect");
	 }
	 function viewVideo(video,context){
		context.drawImage(video,0,0,context.width,context.height);	
		socket.emit('stream',canvas.toDataURL('image/webp'));
		
	 }
	 $(function(){
		navigator.getUserMedia = (navigator.getUserMedia || navigator.
		webkitGetUserMedia || navigator.mozGetUserMedia || navigator.
		msgGetUserMedia);
		if(navigator.getUserMedia) {
		navigator.getUserMedia({video: true},loadCam,loadFail);
		}
		setInterval(function(){
		viewVideo(video,context);
		},50);
	 });
	</script>

  </body>
</html>
